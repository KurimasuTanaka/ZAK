@using BlazorApp.DA;
@using ApplicationsScrappingModule;
@using BlazorApp.Enums;
@using BlazorBootstrap;
@using Microsoft.AspNetCore.Components.Forms
@using BlazorApp.ApplicationsLoader;
@using ZAK.Services.ApplicationsManagerSerivce

@inject IFileLoader fileLoader;
@inject IApplicationsLoader applicationsLoader;

@inject IApplicationsManagerService _applicationsManagerSerivce

<div>
  <InputFile OnChange="@((InputFileChangeEventArgs e) => applicationsFileToLoad = e.File)"></InputFile>

  <Button @ref="updateApplicationButton" class="p-2" Color="ButtonColor.Info"
    @onclick="UpdateApplications">Оновити заявки</Button>
</div>

@code
{
  [Parameter]
  public EventCallback ApplicationsInformationWasChanged { get; set; }

  private Button updateApplicationButton = default!;
  IBrowserFile? applicationsFileToLoad;

  @* Alert noFileAlert = default!;  *@

  private async Task UpdateApplications()
  {
    updateApplicationButton.ShowLoading("Загрузка заявок...");

    if (applicationsFileToLoad is not null) await _applicationsManagerSerivce.UpdateApplications(applicationsFileToLoad);
    else {
      ///Code for alert
      return;
    }
    updateApplicationButton.HideLoading();
}

    
@* 
    await applicationsLoader.AddNewApplications(fileLoader.GetLastLoadedFile());

    //applicationScrapper.ProcessFileWithAddition(fileLoader.GetLastLoadedFile());

    await ApplicationsInformationWasChanged.InvokeAsync();

    fileLoader.DeleteTempFiles(); *@

  }
@* 
  private async void LoadNewApplicationsWithReplacement()
  {
    LoadWithRemoval.ShowLoading("Загрузка заявок...");

    if (applicationsFileToLoad is null)
    {
      return;
    }
    await fileLoader.LoadFile(applicationsFileToLoad);


    await applicationsLoader.AddNewApplicationsWithRemoval(fileLoader.GetLastLoadedFile());


    await ApplicationsInformationWasChanged.InvokeAsync();

    fileLoader.DeleteTempFiles();

    LoadWithRemoval.HideLoading();
  }

  public void LoadFile(InputFileChangeEventArgs e)
  {
    //fileLoader.LoadFile(e.File, "C:/Users/Kurimasu Tanaka/Documents/Coding projects/C#/ZAK/file.html");
    applicationsFileToLoad = e.File;
  }
  *@