@using System.ComponentModel.DataAnnotations;
@using BlazorApp.DA;


@inject IDao<Address, AddressModel> _addressesDataAccess;
@inject ILogger<PriorityInputComponent> _logger;


<InputNumber TValue="double" Label="Приорітет" @bind-Value="@priority" @bind-Value:after="UpdateDbData" />



@code {
    [Parameter] public int addressId {get; set;}
    [Parameter] public double priority { get; set; }
 
    private async Task UpdateDbData()
    {
        _logger.LogInformation($"Updating priority for address with id {addressId} to {priority}");

        Address address = (await _addressesDataAccess.GetAll(query => query.Include(x =>  x.addressPriority).Where(x => x.Id == addressId))).FirstOrDefault()!;

        address.priority = priority;    

        await _addressesDataAccess.Update(
            address, 
            addressId, 
            findPredicate: a => a.Id == addressId,
            includeQuery: a => a.Include(x => x.addressPriority)
            );
    }
}
