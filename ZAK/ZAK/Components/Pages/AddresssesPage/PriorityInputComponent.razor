@using System.ComponentModel.DataAnnotations;
@using BlazorApp.DA;


@inject IDaoBase<Address, AddressModel> _addressesDataAccess;
@inject ILogger<PriorityInputComponent> _logger;


<NumberInput TValue="double" Label="Приорітет" @bind-Value="@priority" @bind-Value:event="UpdateDbData" />



@code {
    [Parameter] public int addressId {get; set;}
    [Parameter] public double priority { get; set; }
 
    private async Task UpdateDbData()
    {
        _logger.LogInformation($"Updating priority for address with id {addressId} to {priority}");

        Address address = await _addressesDataAccess.GetById(addressId);
        address.priority = priority;    

        await _addressesDataAccess.Update(
        address,
        address.Id,
        includeQuery: null,
        findPredicate: a => a.Id == address.Id,
        inputDataProccessingQuery: (a, context) =>
        {
            if(a.applications == null) return a;
            foreach(Application application in a.applications) context.Entry(application).State = EntityState.Unchanged;
            context.Entry(a.district).State = EntityState.Unchanged;
            return a;
        });
    }
}
